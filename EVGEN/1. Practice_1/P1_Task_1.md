# Отчёт по базовым сетевым утилитам

## **PING**

Эта утилита предназначена для проверки доступности сетевого узла и измерения времени отклика.

Принцип работы:

Данная утилита отправляет специальные пакеты (ICMP Echo Request) на указанный IP-адрес или доменное имя. Далее она ожидает ответ - ICMP Echo Reply. Если ответ получен, то значит узел доступен и далее происходит измерение задержки (RTT — round-trip time) между вашим устройством и узлом. Происходит определение потерь пакетов в сети и таким образом выполняется базовая диагностика качества соединения.

Проверим на примере команды: **ping ya.ru**

**Вывод:**

```bash
PS C:\Windows\system32> ping ya.ru
Обмен пакетами с ya.ru [5.255.255.242] с 32 байтами данных:
Ответ от 5.255.255.242: число байт=32 время<1мс TTL=64
Ответ от 5.255.255.242: число байт=32 время<1мс TTL=64
Ответ от 5.255.255.242: число байт=32 время<1мс TTL=64
Ответ от 5.255.255.242: число байт=32 время<1мс TTL=64

Статистика Ping для 5.255.255.242:
 Пакетов: отправлено = 4, получено = 4, потеряно = 0
 (0% потерь)
Приблизительное время приема-передачи в мс:
 Минимальное = 0мсек, Максимальное = 0 мсек, Среднее = 0 мсек
```

**<u>ДОПОЛНИТЕЛЬНО</u>**: если прописать команду **ping -n 4 IP&host**, то число 4 - это количество отправляемых пакетов, его можно самостоятельно изменить. Также для проверки только IPv4 протокола, можно ввести: **ping -4 IP&host**, а для проверки только IPv6 протокола: **ping -6 IP&host** соответственно

## netstat

Утилита **netstat** предназначена для отображения сетевой статистики и информации о сетевых соединениях на компьютере. Данная утилита позволяет:

- Просматривать активные соединения, показывая, какие локальные и удалённые IP-адреса подключены, какие порты используются (TCP/UDP) и в каком состоянии находится соединение (LISTEN, ESTABLISHED, TIME_WAIT и другие);

- Позволяет определить, какое приложение слушает конкретный порт;

- Проверять открытые порты, что может быть удобно для диагностики безопасности и настройки серверов;

- Собирать статистику по протоколам, состоящую из количества активных соединений, ошибок, сброшенных пакетов и другое;

Используем команду **netstat -a** для отображения всех соединений и портов, которые слушаются в данный момент:

```bash
PS C:\Windows\system32> netstat -a

Активные подключения

  Имя    Локальный адрес        Внешний адрес          Состояние
  TCP    0.0.0.0:135            DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:445            DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:2869           DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:5040           DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:5357           DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:49664          DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:49665          DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:49666          DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:49667          DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:49669          DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:49676          DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:49678          DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:54950          DESKTOP-92EBQFB:0      LISTENING
  TCP    0.0.0.0:55536          DESKTOP-92EBQFB:0      LISTENING
  TCP    127.0.0.1:2080         DESKTOP-92EBQFB:0      LISTENING
  TCP    127.0.0.1:17742        DESKTOP-92EBQFB:49683  ESTABLISHED
  TCP    127.0.0.1:17868        DESKTOP-92EBQFB:49683  ESTABLISHED
  TCP    127.0.0.1:49683        DESKTOP-92EBQFB:0      LISTENING
  TCP    127.0.0.1:49683        DESKTOP-92EBQFB:17742  ESTABLISHED
  TCP    127.0.0.1:49683        DESKTOP-92EBQFB:17868  ESTABLISHED
  TCP    127.0.0.1:49705        DESKTOP-92EBQFB:49706  ESTABLISHED
  TCP    127.0.0.1:49706        DESKTOP-92EBQFB:49705  ESTABLISHED
  TCP    127.0.0.1:49842        DESKTOP-92EBQFB:0      LISTENING
  TCP    127.0.0.1:49842        DESKTOP-92EBQFB:49856  ESTABLISHED
  TCP    127.0.0.1:49856        DESKTOP-92EBQFB:49842  ESTABLISHED
  TCP    172.19.0.1:139         DESKTOP-92EBQFB:0      LISTENING
  TCP    172.19.0.1:13484       lr-in-f188:https       ESTABLISHED
  TCP    172.19.0.1:13553       xiva-daria:https       ESTABLISHED
  TCP    172.19.0.1:17357       149.154.167.41:https   ESTABLISHED
  TCP    172.19.0.1:17644       172.64.148.235:https   ESTABLISHED
  TCP    172.19.0.1:17716       api:https              ESTABLISHED
  TCP    172.19.0.1:17718       172.64.155.209:https   ESTABLISHED
```

Мы также можем посмотреть вывод адресов и портов в числовом виде (без DNS-имен), воспользовавшись командой - **netstat -n**

```bash
PS C:\Windows\system32> netstat -n

Активные подключения

  Имя    Локальный адрес        Внешний адрес          Состояние
  TCP    127.0.0.1:17742        127.0.0.1:49683        ESTABLISHED
  TCP    127.0.0.1:17868        127.0.0.1:49683        ESTABLISHED
  TCP    127.0.0.1:49683        127.0.0.1:17742        ESTABLISHED
  TCP    127.0.0.1:49683        127.0.0.1:17868        ESTABLISHED
  TCP    127.0.0.1:49705        127.0.0.1:49706        ESTABLISHED
  TCP    127.0.0.1:49706        127.0.0.1:49705        ESTABLISHED
  TCP    127.0.0.1:49842        127.0.0.1:49856        ESTABLISHED
  TCP    127.0.0.1:49856        127.0.0.1:49842        ESTABLISHED
  TCP    172.19.0.1:13484       209.85.233.188:443     ESTABLISHED
  TCP    172.19.0.1:13553       213.180.204.179:443    ESTABLISHED
  TCP    172.19.0.1:17357       149.154.167.41:443     ESTABLISHED
  TCP    172.19.0.1:17644       172.64.148.235:443     ESTABLISHED
  TCP    172.19.0.1:17716       213.180.193.234:443    ESTABLISHED
  TCP    172.19.0.1:17718       172.64.155.209:443     ESTABLISHED
  TCP    172.19.0.1:17721       172.64.151.87:443      ESTABLISHED
  TCP    172.19.0.1:17724       104.18.32.47:443       ESTABLISHED
  TCP    172.19.0.1:17743       213.180.193.234:443    ESTABLISHED
  TCP    172.19.0.1:17751       213.180.193.234:443    ESTABLISHED
  TCP    172.19.0.1:17840       5.255.255.77:443       ESTABLISHED
  TCP    172.19.0.1:17860       213.180.193.234:443    ESTABLISHED
  TCP    172.19.0.1:17889       87.250.250.91:443      ESTABLISHED
  TCP    172.19.0.1:17891       87.250.251.119:443     ESTABLISHED
  TCP    172.19.0.1:17893       213.180.193.234:443    ESTABLISHED
  TCP    172.19.0.1:17895       195.122.177.172:443    ESTABLISHED
  TCP    172.19.0.1:17937       213.180.204.29:443     ESTABLISHED
  TCP    172.19.0.1:17973       185.201.1.87:443       ESTABLISHED
  TCP    172.19.0.1:18001       140.82.113.26:443      ESTABLISHED
  TCP    172.19.0.1:18003       87.250.251.183:443     CLOSE_WAIT
  TCP    192.168.1.112:13498    209.85.233.188:443     ESTABLISHED
  TCP    192.168.1.112:13554    213.180.204.179:443    ESTABLISHED
  TCP    192.168.1.112:14121    192.168.1.106:8009     ESTABLISHED
  TCP    192.168.1.112:14122    192.168.1.106:8009     ESTABLISHED
  TCP    192.168.1.112:17363    149.154.167.41:443     ESTABLISHED
  TCP    192.168.1.112:17645    185.247.140.23:443     ESTABLISHED
  TCP    192.168.1.112:17717    213.180.193.234:443    ESTABLISHED
  TCP    192.168.1.112:17719    185.247.140.23:443     ESTABLISHED
  TCP    192.168.1.112:17723    185.247.140.23:443     ESTABLISHED
  TCP    192.168.1.112:17725    185.247.140.23:443     ESTABLISHED
  TCP    192.168.1.112:17744    213.180.193.234:443    ESTABLISHED
  TCP    192.168.1.112:17760    185.247.140.23:443     ESTABLISHED
  TCP    192.168.1.112:17766    213.180.193.234:443    ESTABLISHED
  TCP    192.168.1.112:17841    5.255.255.77:443       ESTABLISHED
  TCP    192.168.1.112:17861    213.180.193.234:443    ESTABLISHED
  TCP    192.168.1.112:17890    87.250.250.91:443      ESTABLISHED
  TCP    192.168.1.112:17892    87.250.251.119:443     ESTABLISHED
  TCP    192.168.1.112:17894    213.180.193.234:443    ESTABLISHED
  TCP    192.168.1.112:17896    195.122.177.172:443    ESTABLISHED
  TCP    192.168.1.112:17938    185.247.140.23:443     ESTABLISHED
  TCP    192.168.1.112:17974    185.201.1.87:443       ESTABLISHED
  TCP    192.168.1.112:18002    185.247.140.23:443     ESTABLISHED
  TCP    192.168.1.112:18004    185.247.140.23:443     CLOSE_WAIT
  TCP    192.168.1.112:18030    62.115.253.224:443     TIME_WAIT
  TCP    192.168.1.112:49684    4.207.247.139:443      ESTABLISHED
  TCP    192.168.1.112:49707    62.67.238.208:443      ESTABLISHED
```

Также можно добавить отображение PID процесса, которому принадлежит соединение - выполнив - **netstat -o**

```bash
PS C:\Windows\system32> netstat -o

Активные подключения

  Имя    Локальный адрес        Внешний адрес          Состояние       PID
  TCP    127.0.0.1:17742        DESKTOP-92EBQFB:49683  ESTABLISHED     12844
  TCP    127.0.0.1:17868        DESKTOP-92EBQFB:49683  ESTABLISHED     12844
  TCP    127.0.0.1:18055        DESKTOP-92EBQFB:wsd    TIME_WAIT       0
  TCP    127.0.0.1:49683        DESKTOP-92EBQFB:17742  ESTABLISHED     4472
  TCP    127.0.0.1:49683        DESKTOP-92EBQFB:17868  ESTABLISHED     4472
  TCP    127.0.0.1:49705        DESKTOP-92EBQFB:49706  ESTABLISHED     4472
  TCP    127.0.0.1:49706        DESKTOP-92EBQFB:49705  ESTABLISHED     4472
  TCP    127.0.0.1:49842        DESKTOP-92EBQFB:49856  ESTABLISHED     13452
  TCP    127.0.0.1:49856        DESKTOP-92EBQFB:49842  ESTABLISHED     13380
  TCP    172.19.0.1:13484       lr-in-f188:https       ESTABLISHED     12844
  TCP    172.19.0.1:13553       xiva-daria:https       ESTABLISHED     12844
  TCP    172.19.0.1:17357       149.154.167.41:https   ESTABLISHED     6700
  TCP    172.19.0.1:17644       172.64.148.235:https   ESTABLISHED     12844
  TCP    172.19.0.1:17716       api:https              ESTABLISHED     12844
  TCP    172.19.0.1:17718       172.64.155.209:https   ESTABLISHED     12844
  TCP    172.19.0.1:17721       172.64.151.87:https    ESTABLISHED     12844
  TCP    172.19.0.1:17724       104.18.32.47:https     ESTABLISHED     12844
```

Зная PID процесса можно полностью управлять им, например, завершить процесс, чтобы убрать его из активных подключений.

А команда **netstat -s** позволит нам получить статистику по протоколам (TCP, UDP, ICMP):

```bash
PS C:\Windows\system32> netstat -s

Статистика IPv4

  Получено пакетов                   = 357399
  Получено ошибок в заголовках       = 0
  Получено ошибок в адресах          = 595
  Направлено датаграмм               = 6
  Получено неизвестных протоколов    = 0
  Отброшено полученных пакетов       = 7225
  Доставлено полученных пакетов      = 370296
  Запросов на вывод                  = 321813
  Отброшено маршрутов                = 0
  Отброшено выходных пакетов         = 4
  Выходных пакетов без маршрута      = 10
  Требуется сборка                   = 0
  Успешная сборка                    = 0
  Сбоев при сборке                   = 0
  Успешно фрагментировано датаграмм  = 0
  Сбоев при фрагментации датаграмм   = 0
  Создано фрагментов                 = 0

Статистика IPv6

  Получено пакетов                   = 18585
  Получено ошибок в заголовках       = 0
  Получено ошибок в адресах          = 760
  Направлено датаграмм               = 0
  Получено неизвестных протоколов    = 0
  Отброшено полученных пакетов       = 4373
  Доставлено полученных пакетов      = 28703
  Запросов на вывод                  = 14696
  Отброшено маршрутов                = 0
  Отброшено выходных пакетов         = 0
  Выходных пакетов без маршрута      = 0
  Требуется сборка                   = 0
  Успешная сборка                    = 0
  Сбоев при сборке                   = 0
  Успешно фрагментировано датаграмм  = 0
  Сбоев при фрагментации датаграмм   = 0
  Создано фрагментов                 = 0

Статистика ICMPv4

                            Получено   Отправлено
  Сообщений                 306         1494
  Ошибок                    0           0
  'Назначение недостижимо'  283         1471
  Превышений времени        0           0
  Ошибок в параметрах       0           0
  Просьб "снизить скорость" 0           0
  Переадресовано            0           0
  Ответных пакетов          23          0
  Эхо-сообщений             0           23
  Отметок времени           0           0
  Ответы на отметки времени  0           0
  Масок адресов             0           0
  Ответов на маски адресов  0           0
  Маршрутизатор             0           0
  Маршрутизатор             0           0

ICMPv6 Статистика

                            Получено    Отправлено
  Сообщений                 273         325
  Ошибок                    0           0
  'Назначение недостижимо'  68          112
  Пакет слишком велик       0           0
  Превышений времени        0           0
  Ошибок в параметрах       0           0
  Эхо-сообщений             0           0
  Ответных пакетов          0           0
  MLD-запросы               0           0
  MLD-отчеты                0           0
  MLD выполнено             0           0
  Маршрутизатор             0           6
  Маршрутизатор             0           0
  Окружение                 176         178
  Окружение                 29          29
  Переадресовано            0           0
  Перенумер. маршрутизатора 0           0

Статистика TCP для IPv4

  Активных открыто                    = 4539
  Пассивных открыто                   = 330
  Сбоев при подключении               = 26
  Сброшено подключений                = 144
  Текущих подключений                 = 77
  Получено сегментов                  = 738019
  Отправлено сегментов                = 696641
  Повторно отправлено сегментов       = 984

Статистика TCP для IPv6

  Активных открыто                    = 438
  Пассивных открыто                   = 294
  Сбоев при подключении               = 2
  Сброшено подключений                = 6
  Текущих подключений                 = 0
  Получено сегментов                  = 5349
  Отправлено сегментов                = 5628
  Повторно отправлено сегментов       = 4

Статистика UDP для IPv4

  Получено датаграмм    = 76584
  Отсутствие портов     = 2674
  Ошибки при получении  = 22766
  Отправлено датаграмм  = 36423

Статистика UDP для IPv6

  Получено датаграмм    = 44353
  Отсутствие портов     = 124
  Ошибки при получении  = 13267
  Отправлено датаграмм  = 11382
```

Все вышеперечисленные команды имеют ключи, которые можно комбинировать для использования уникальной одной команды, например: **netstat -ano** комбинирует вывод с ключём -a, -n, -o. Также вывод можно фильтровать, вот как будет выглядить такая команда - **netstat -ano | findstr TCP** (фильтрует только TCP) или **netstat -ano | findstr :80** фильтрует вывод конкретно по порту 80.

```bash
PS C:\Windows\system32> netstat -ano | findstr :80
  TCP    192.168.1.112:14121    192.168.1.106:8009     ESTABLISHED     9824
  TCP    192.168.1.112:14122    192.168.1.106:8009     ESTABLISHED     12844
```

## tracert

Данная утилита предназначена для определения маршрута следования пакетов до указанного узла (IP-адреса или доменного имени). Она показывает **все промежуточные устройства (маршрутизаторы)**, через которые проходят пакеты, а также время отклика от каждого узла.

**Принцип работы** утилиты следующий:

Утилита tracert отправляет ICMP-пакеты с увеличивающимся значением параметра **TTL (Time To Live)**, затем каждый маршрутизатор по пути уменьшает TTL на 1. Когда TTL достигает 0, маршрутизатор отвечает сообщением об ошибке и следовательно  так определяется последовательность узлов до конечного адресата.

Утилита помогает:

- Выявить точки сбоя - на каком маршрутизаторе пакет теряется;

- Понять структуру сети - показывает, через какие провайдеры и страны проходит трафик;

- Измерять задержки (latency) - видно, сколько миллисекунд занимает прохождение пакета до каждого узла.

Введём базовую команду: **tracert ya.ru**, где ya.ru - это хост

```bash
PS C:\Windows\system32> tracert ya.ru

Трассировка маршрута к ya.ru [5.255.255.242]
с максимальным числом прыжков 30:

  1    <1 мс    <1 мс    <1 мс  ya.ru [5.255.255.242]

Трассировка завершена.
```

После выполнения данной команды - утилита показывает путь, по которому пакеты идут до узла, через какие маршрутизаторы проходят, и сколько миллисекунд занимает каждый шаг.

Также мы можем указать число попыток, добавив в команду: **tracert -w 1000 ya.ru**, где 1000 - таймаут 1000 мс.

```bash
PS C:\Windows\system32> tracert -w 1000 ya.ru

Трассировка маршрута к ya.ru [5.255.255.242]
с максимальным числом прыжков 30:

  1    <1 мс    <1 мс    <1 мс  ya.ru [5.255.255.242]

Трассировка завершена.
```

Вывод можно разобрать так: слева цифра 1 - это номер (хоп - маршрутизатор на пути), цифры в мс - задержка до этого хопа, а имя/IP - адрес узла.

Как и в случае с ping, можно добавить указание протокола IPv4 или IPv6 принудительно изменив команду на: **tracert -4 ya.ru** и **tracert -6 ya.ru** соответственно.

## nslookup

Утилита nslookup (name server lookup) предназначена для получения информации из системы доменных имён (**DNS**). При помощи этой утилиты можно:

- Узнать IP-адрес по доменному имени;

- И наоборот, узнать доменное имя по IP-адресу;

- Проверить работу DNS-серверов;

- Диагностировать проблемы с доменными именами;

- Получить дополнительные записи DNS (TXT, MX, NS и другие);

Принцип работы утилиты следующий: 

1. Утилита обращается к **DNS-серверу**, который указан в настройках вашей системы (обычно это сервер провайдера или, например, 8.8.8.8 - Google DNS).

2. DNS-сервер ищет в своей базе нужную запись (или пересылает запрос другим серверам, пока не найдёт ответ).

По сути утилита делает запросы к DNS серверу:

- **Этап 1-й: Формирование DNS-запроса** - утилита отправляет пакет на указанный (или системный) DNS-сервер.

- **Этап 2-й: Поиск записи**:
  
  - если сервер знает ответ - он возвращает IP-адрес (или другую запись),
  
  - если не знает - пересылает запрос выше по цепочке (например, к корневым DNS).

- **Этап 3-й: Получение ответа** - утилита выводит результат пользователю: IP-адрес, имя хоста, записи MX, NS, TXT и др.

Попробуем узнать IP адрес домена, введя команду: **nslookup ya.ru**

```bash
PS C:\Windows\system32> nslookup ya.ru
╤хЁтхЁ:  dns.google
Address:  8.8.8.8

Не заслуживающий доверия ответ:
╚ь :     ya.ru
Addresses:  2a02:6b8::2:242
          77.88.55.242
          5.255.255.242
          77.88.44.242
```

Сообщение **«Не заслуживающий доверия ответ:»** (англ. **"Non-authoritative answer:"**) означает, что ответ получен **не от авторитетного DNS-сервера** для данного домена. Далее мы видим IP адреса, которые принадлежат домену ya.ru.

Узнать NS-сервера (Name Server - кто обслуживает домен) можно при помощи команды: **nslookup -type=NS ya.ru**:

```bash
PS C:\Windows\system32> nslookup -type=NS ya.ru
╤хЁтхЁ:  dns.google
Address:  8.8.8.8

Не заслуживающий доверия ответ:
ya.ru   nameserver = ns1.yandex.ru
ya.ru   nameserver = ns2.yandex.ru
```

Видим, что у Яндекс два NS сервера.

Узнать MX-записи (Mail eXchanger - почтовые сервера домена) можно при помощи команды: **nslookup -type=MX ya.ru**:

```bash
PS C:\Windows\system32> nslookup -type=MX ya.ru
╤хЁтхЁ:  dns.google
Address:  8.8.8.8

Не заслуживающий доверия ответ:
ya.ru   MX preference = 10, mail exchanger = mx.yandex.ru
```

Ответ показывает mx почтовый сервер Яндекса и его приоритет 10.

Мы также можем узнать доменное имя по IP адресу при помощи команды: **nslookup 77.88.44.242**:

```bash
PS C:\Windows\system32> nslookup 77.88.44.242
╤хЁтхЁ:  dns.google
Address:  8.8.8.8

╚ь :     ya.ru
Address:  77.88.44.242
```
